deploy-to-test:
  stage: deploy
  script:
    - echo -e "\e[32mDeploying to TEST Environment\e[0m"
  rules:
    - if: '$CI_COMMIT_REF_NAME == "test" || $CI_COMMIT_TAG =~ /^test-\d{8}/'
      when: always
    - when: never

#  rules:
#    - if: '$CI_COMMIT_REF_NAME == "test"'
#      when: always
#    - when: never

deploy-to-production:
  stage: deploy
  script:
    - echo -e "\e[1;31mDeploying to production Environment\e[0m"
  rules:
    #- if: '$CI_COMMIT_TAG =~ /^prod-\d{8}$/ && $CI_PIPELINE_SOURCE == "trigger" '
    - if: '$CI_COMMIT_REF_NAME == "main" &&  $CI_PIPELINE_SOURCE == "web"'
      when: manual
    - when: never
  release:
    tag_name: $CI_COMMIT_TAG
    ref: $CI_COMMIT_REF_NAME
    name: "Release for $CI_COMMIT_TAG"
    description: |
      $(cat RELEASE_NOTES.md)
